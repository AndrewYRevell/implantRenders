---
layout: default
---
**_No identifying patient information is present. No MRIs nor any of the 18 [HIPAA-designated](https://www.hhs.gov/hipaa/for-professionals/privacy/special-topics/de-identification/index.html) direct identifiers and indirect identifiers are contained within this webpage. Only Javascript compatible 3D brain surface files (.glb, which do not contain any header or metadata information) and implant xyz coordinate files (.txt) are used. This webpage is intended to navigate intracranial EEG implants in 3D space ONLY._**
  
-------------------------------------

-------------------------------------
 
Made by Andrew Revell (Fifth-year MD/PhD student at Penn): 

[My GitHub](https://github.com/andyrevell)

<img src="./pics/londonPhone18.png" width="150">  

# Implant Links


**Click to view "[Phase II](https://www.pennmedicine.org/for-patients-and-visitors/find-a-program-or-service/neurosurgery/seizures-and-epilepsy/diagnosing-and-evaluation)" implant in the [Epilepsy Monitoring Unit (EMU)](https://www.thedp.com/article/2021/02/penn-medicine-establishes-a-new-epilepsy-monitoring-unit):**

|                                                           |
| :---------------------------------------------------      | :----------------------------------------------------     | :---------------------------------------------------      | :---------------------------------------------------      | :-------------------------------------------------------------  | :----------------------------------------------------     | :----------------------------------------------------     | :-------------------------------------------------------  | :---------------------------------------------------      | :-------------------------------------                    |
| [13](./renders/sub-RID0013/ses-implant01/index.html)      | [15](./renders/sub-RID0015/ses-implant01/index.html)  | [18](./renders/sub-RID0018/ses-implant01/index.html)      | [20](./renders/sub-RID0020/ses-implant01/index.html)      | [21](./renders/sub-RID0021/ses-implant01/index.html)            | [24](./renders/sub-RID0024/ses-implant01/index.html)      | [27](./renders/sub-RID0027/ses-implant01/index.html)      | [30](./renders/sub-RID0030/ses-implant01/index.html)         | [31](./renders/sub-RID0031/ses-research3Tv00/index.html)  | [32](./renders/sub-RID0032/ses-research3Tv00/index.html)  |   
| 33                                                        | 37                                                        | 42                                                        | 48                                                        | 49                                                              | 50                                                        | 51                                                        | 54                                                        | 55                                                        | 58                                                        |
| 59                                                        | 65                                                        | 68                                                        | 69                                                        | 89                                                              | 101                                                       | 102                                                       | 106                                                       | 117                                                       | [131](./renders/sub-RID0131/ses-implant01/index.html)     | 
| [139](./renders/sub-RID0139/ses-research3Tv03/index.html) | 142                                                       | [143](./renders/sub-RID0143/ses-research3Tv00/index.html)   | [146](./renders/sub-RID0146/ses-implant01/index.html)     | 157                                                             | 160                                                       | 165                                                       | [171](./renders/sub-RID0171/ses-implant01/index.html)  | 175                                                       | 179                                                       |
| [186](./renders/sub-RID0186/ses-implant01/index.html)     | [190](./renders/sub-RID0190/ses-research3Tv00/index.html)  | [192](./renders/sub-RID0192/ses-implant01/index.html)   | [190](./renders/sub-RID0190/ses-implant01/index.html)  | [194](./renders/sub-RID0194/ses-research3Tv01/index.html)       | [206](./renders/sub-RID0206/ses-implant01/index.html)     | [213](./renders/sub-RID0213/ses-research3Tv01/index.html) | [218](./renders/sub-RID0218/ses-implant01/index.html)     | [222](./renders/sub-RID0222/ses-implant01/index.html)  | [227](./renders/sub-RID0227/ses-implant01/index.html)   |
| [230](./renders/sub-RID0230/ses-implant01/index.html)     | [238](./renders/sub-RID0238/ses-implant01/index.html)     | [240](./renders/sub-RID0240/ses-implant01/index.html)     | [241](./renders/sub-RID0241/ses-implant01/index.html)  | [250](./renders/sub-RID0250/ses-implant01/index.html) | [252](./renders/sub-RID0252/ses-implant01/index.html)   | 259                                                       | [267](./renders/sub-RID0267/ses-implant01/index.html)     | [272](./renders/sub-RID0272/ses-implant01/index.html)  | [274](./renders/sub-RID0274/ses-implant01/index.html)  |
| [278](./renders/sub-RID0278/ses-research3Tv01/index.html) | [279](./renders/sub-RID0279/ses-implant01/index.html)     | [280](./renders/sub-RID0280/ses-implant01/index.html)  | [294](./renders/sub-RID0294/ses-implant01/index.html) | [295](./renders/sub-RID0295/ses-implant01/index.html)   | [296](./renders/sub-RID0296/ses-implant01/index.html)    | [307](./renders/sub-RID0307/ses-implant01/index.html) | [309](./renders/sub-RID0309/ses-research3Tv01/index.html) | [317](./renders/sub-RID0317/ses-implant01/index.html)     | [320](./renders/sub-RID0320/ses-research3Tv01/index.html) |
| [322](./renders/sub-RID0322/ses-implant01/index.html)  | [325](./renders/sub-RID0325/ses-implant01/index.html) | [328](./renders/sub-RID0328/ses-implant01/index.html)  | [329](./renders/sub-RID0329/ses-implant01/index.html) | [330](./renders/sub-RID0330/ses-implant01/index.html)   | [332](./renders/sub-RID0332/ses-implant01/index.html)     | [334](./renders/sub-RID0334/ses-implant01/index.html)    | [337](./renders/sub-RID0337/ses-implant01/index.html)     | [338](./renders/sub-RID0338/ses-implant01/index.html)  | [341](./renders/sub-RID0341/ses-research3Tv03/index.html) |
| [356](./renders/sub-RID0356/ses-implant01/index.html)  | [357](./renders/sub-RID0357/ses-implant01/index.html) | [365](./renders/sub-RID0365/ses-research3Tv02/index.html) | [371](./renders/sub-RID0371/ses-implant01/index.html) | [380](./renders/sub-RID0380/ses-research3Tv02/index.html)       | [381](./renders/sub-RID0381/ses-implant01/index.html)  | [382](./renders/sub-RID0382/ses-implant01/index.html)  | [385](./renders/sub-RID0385/ses-implant01/index.html)     | [386](./renders/sub-RID0386/ses-implant01/index.html)     | [392](./renders/sub-RID0392/ses-implant01/index.html)     |
| [394](./renders/sub-RID0394/ses-research3Tv02/index.html) | [405](./renders/sub-RID0405/ses-implant01/index.html)     | [412](./renders/sub-RID0412/ses-implant01/index.html)     | [420](./renders/sub-RID0420/ses-research3Tv02/index.html) | [424](./renders/sub-RID0424/ses-implant01/index.html)           | [440](./renders/sub-RID0440/ses-research3Tv02/index.html) | [442](./renders/sub-RID0442/ses-implant01/index.html)     | [452](./renders/sub-RID0452/ses-implant01/index.html)     | [454](./renders/sub-RID0454/ses-research3Tv02/index.html) | [459](./renders/sub-RID0459/ses-research3Tv02/index.html) |
| [472](./renders/sub-RID0472/ses-implant01/index.html)     | [475](./renders/sub-RID0475/ses-implant01/index.html)     | [476](./renders/sub-RID0476/ses-research3Tv03/index.html) | [490](./renders/sub-RID0490/ses-research3Tv03/index.html) | [502](./renders/sub-RID0502/ses-research3Tv03/index.html)       | [508](./renders/sub-RID0508/ses-research3Tv03/index.html) | [517](./renders/sub-RID0517/ses-implant01/index.html)     | [520](./renders/sub-RID0520/ses-research3Tv03/index.html) | [522](./renders/sub-RID0522/ses-research3Tv03/index.html) | [529](./renders/sub-RID0529/ses-research3Tv03/index.html) | 
| [530](./renders/sub-RID0530/ses-implant01/index.html)  | [536](./renders/sub-RID0536/ses-research3Tv03/index.html) | [560](./renders/sub-RID0560/ses-implant01/index.html) | [562](./renders/sub-RID0562/ses-implant01/index.html) | [566](./renders/sub-RID0566/ses-research3Tv03/index.html)  | [572](./renders/sub-RID0572/ses-research3Tv03/index.html) | [582](./renders/sub-RID0582/ses-implant01/index.html)     | [583](./renders/sub-RID0583/ses-research3Tv03/index.html) | [588](./renders/sub-RID0588/ses-implant01/index.html)     | [589](./renders/sub-RID0589/ses-research3Tv03/index.html) |                       
| [595](./renders/sub-RID0595/ses-research3Tv03/index.html) | [596](./renders/sub-RID0596/ses-research3Tv03/index.html) | [646](./renders/sub-RID0646/ses-research3Tv03/index.html)  | [647](./renders/sub-RID0647/ses-implant01/index.html)      | [648](./renders/sub-RID0648/ses-research3Tv03/index.html)       | [649](./renders/sub-RID0649/ses-implant01/index.html) | [650](./renders/sub-RID0650/ses-implant01/index.html)     | [651](./renders/sub-RID0651/ses-implant01/index.html) | [652](./renders/sub-RID0652/ses-research3Tv03/index.html) | [193](./renders/sub-RID0193/ses-implant01/index.html)                                                          |                              


**Click to view [RNS](https://www.epilepsy.com/learn/treating-seizures-and-epilepsy/devices/responsive-neurostimulation-rns) implant:**

|                                                 |
|:------------------------------------------      |:------------------------------------------ |:------------------------------------------|:------------------------------------------|:------------------------------------------|
|[15](./renders/sub-RID0015/ses-RNS01/index.html)  | [30](./renders/sub-RID0030/ses-RNS01/index.html) | 165                                       | [171](./renders/sub-RID0171/ses-RNS01/index.html) |[186](./renders/sub-RID0186/ses-RNS01/index.html) |
|[206](./renders/sub-RID0206/ses-RNS01/index.html)| [252](./renders/sub-RID0252/ses-RNS01/index.html) | [272](./renders/sub-RID0272/ses-RNS01/index.html)  | [280](./renders/sub-RID0280/ses-RNS01/index.html)   |[328](./renders/sub-RID0328/ses-RNS01/index.html)   |
|[334](./renders/sub-RID0337/ses-RNS01/index.html) | [337](./renders/sub-RID0337/ses-RNS01/index.html)  | 

- Notes:
	- 13: Cortical surface of right temporal lobe is correct. Grid overlaid on right temporal lobe is correct.
	- 15: Surface reconstruction failed in Freesurfer.
	- 30: Missing coordinate files
	- 165: Freesurfer stuck in running mris_fix topology. 
	- 186: Initial surface reconstruction of pre-implant image failed. Used the alternative clinical T1 imaging with very anisotropic voxels (and barely fully covers the lateral parts of brain).
	- 194: Channel coordinates and surface reconstruction are correct. 
	- 218: Surface reconstruction failed.
	- 280: Using implant T1. Tissue classification will be incorrect (areas where electrodes are will most likely be classified as CSF because of the holes in the MRI)
	- 320: Registration a little off: Brain extraction of clinical T1 to the research 3T is off by some translation/rotation. Thus coordinates are off too.
	- 338: Freesurfer brain extraction, and thus tissue segmentation had large errors - due to poor quality clinical imaging 
	- 386: Freesurfer stuck in running mris_fix_topology.
	- 476: Channel coordinates and surface reconstruction are correct. 
	- 520: Registration a little off: Brain extraction of clinical T1 to the research 3T is off by some translation/rotation. Thus coordinates are off too.
	- 192: failed
	- 241: failed
	- 250: failed
	- 179: failed
	- 157: failed
	
# About

These renders show implantations of epilepsy patients. Implantations were done for clinical purposes and to capture seizure activity. Click on the subject links in the table above to view the renders. You can adjust your view using your mouse and control settings (see below image). On mobile, toggle off "Brain wireframe" for quicker view adjustments. Click on "Channels" to see the channel label names. Spheres represent implanted electrode channels. The center of each sphere corresponds to the coordinate of each channel. Each spehere is arbitrarily 2.2 mm in radius. The coordinates of each channel is localized to specific brain tissue: gray matter (GM), white matter (WM), cerebrospinal fluid (CSF), or outside the brain area. 

Colored spheres correspond to these areas:

<span style="color:red">RED</span>: GM

<span style="color:blue">BLUE</span>: WM

<span style="color:purple">PURPLE</span>: CSF

WHITE: OUTSIDE (or not localized to any area)
 
_if all channels are blue, localization information absent_

![aboutImage](./pics/about.png)





#### Note on channel tissue localization:
The tissue type corresponding to each channel is determined by the SINGLE voxel the channel coordinate is in, and thus subject to errors.

Example: a specific voxel is determined to be GM through the FIRST and FAST FSL algorithms (see figure below). The channel is localized to that voxel. However, all surrounding voxels happen to be WM. It could be assumed then that the tissue type of that particular channel was determined to be wrong in this case - because all surrounding voxels of that channel are WM. Furthermore, tissue localization for ECoG (grids and strips) may not be necessarily correct. They can be assumed to be in CSF overlaid on GM cortical structures.

The FIRST and FAST algorithms have a smoothing factor to mitigate this issue to some extent. Please take this into consideration when relying on the specifc tissue type of each channel when interpreting these localizations. See this image below for an overview of the localization procedure: 

![aboutImage](./pics/localization_v01.png)
NOTE: This figure is now outdated. Freesurfer's segmentation is now used. GM is considered any cortical/subcortical areas found in the aseg.mgz output, WM is considered the WM regions in aseg.mgz (including Corpus Collosum labels), and CSF is any brain extracted areas (using the mri/brain.mgz file) but not in GM or WM. Outside the brain electrodes are ones that fall outside this brain extracted file. 
Figure legend: Electrode localization and Tissue Segmentation. Each channel is localized to a specific tissue type shown by the figure above. (1) A CT is acquired of the implantation. (2) The coordinates of each channel is determined through our clinical localization pipeline, and registered to an implant image (3) and a preimplant image (4). Using the preimplant image, tissue type is determined using FSL's FIRST and FAST algorithms. Output of the cortical segmentation (FAST) is shown in (5) and output of the subcortical segmentation (FIRST) is shown in (6). These images are combined (7). The electrode coordinates are determined in preimplant space using FSL's linear registration (not non-linear - the figure is wrong here and will be updated). The exact coordinate of the electrode channel is matched to a voxel in the tissue segmentation combined image (7) and thus the type of tissue the channel is sampling from is determined. WARNING: This method does not consider surrounding voxels, and thus a channel may be erroneously determined to be sampling from the wrong tissue in rare cases.


# Metadata


| Subject | Implant     |  Sampling  | T1 scan used for surface  |                                
| :------ | :---------- | :--------- | :------------------------ |
| 13      | ECoG        | bilateral  | clinical                  |
| 15      | ECoG        | bilateral  | clinical                  |
| 18      | ECoG        | bilateral  | clinical                  |
| 20      | ECoG        | bilateral  | clinical                  |
| 21      | ECoG        | bilateral  | clinical                  |
| 24      | ECoG        | right      | clinical                  |
| 27      | ECoG        | bilateral  | clinical                  |
| 30      | ????        | ??????     | clinical                  |
| 31      | SEEG        | bilateral  | research                  |
| 32      | ECoG        | right      | research                  |
| 131     | SEEG        | left       | clinical                  |
| 139     | SEEG        | bilateral  | research                  |
| 143     |         |   | research                  |
| 146     | SEEG        | bilateral  | clinical                  |
| 160     |         |        | clinical                  |
| 171     | ECoG        | left       | clinical                  |
| 175     |         |        | clinical                  |
| 186     | SEEG        | bilateral  | clinical                  |
| 190     |         |   | research                  |
| 192     |         |   | clinical                  |
| 193     | ECoG        | right      | clinical                  |
| 194     | SEEG        | bilateral  | research                  |
| 206     | SEEG        | bilateral  | clinical                  |
| 213     | ECoG        | bilateral  | research                  |
| 218     | SEEG        | bilateral  | clinical                  |
| 222     | ECoG        | left       | clinical                  |
| 227     | SEEG        | bilateral  | clinical                  |
| 230     | SEEG        | bilateral  | clinical                  |
| 238     | SEEG        | bilateral  | clinical                  |
| 240     | SEEG        | bilateral  | clinical                  |
| 241     |         |   | clinical                  |
| 250     |         |        | clinical                  |
| 252     | SEEG        | left       | clinical                  |
| 267     | SEEG        | bilateral  | clinical                  |
| 272     | SEEG        | bilateral  | clinical                  |
| 274     | SEEG        | right      | clinical                  |
| 278     | SEEG        | bilateral  | research                  |
| 279     | SEEG        | bilateral  | clinical                  |
| 280     | SEEG        | bilateral  | implant                   |
| 294     | SEEG        | bilateral  | clinical                  |
| 295     | ECoG        | left       | clinical                  |
| 296     | SEEG        | bilateral  | clinical                  |
| 309     | SEEG        | bilateral  | research                  |
| 307     | SEEG        | bilateral  | clinical                  |
| 317     | SEEG        | bilateral  | clinical                  |
| 320     | SEEG        | bilateral  | research                  |
| 322     | SEEG        | right      | clinical                  |
| 325     | SEEG        | bilateral  | clinical                  |
| 328     | SEEG        | bilateral  | clinical                  |
| 329     | SEEG        | bilateral  | clinical                  |
| 330     | SEEG        | bilateral  | clinical                  |
| 332     | SEEG        | bilateral  | clinical                  |
| 334     | SEEG        | left       | clinical                  |
| 337     | ????        | ??????     | clinical                  |
| 338     | SEEG        | bilateral  | clinical                  |
| 341     | SEEG        | bilateral  | research                  |
| 356     | SEEG        | bilateral  | clinical                  |
| 357     | ECoG        | right      | clinical                  |
| 365     | SEEG        | bilateral  | research                  |
| 371     | SEEG        | bilateral  | clinical                  |
| 380     | SEEG        | bilateral  | research                  |
| 381     | SEEG        | bilateral  | clinical                  |
| 382     | SEEG        | bilateral  | clinical                  |
| 385     | SEEG        | bilateral  | clinical                  |
| 386     | SEEG        | bilateral  | clinical                  |
| 392     | SEEG        | bilateral  | clinical                  |
| 394     | SEEG        | bilateral  | research                  |
| 405     | SEEG        | bilateral  | clinical                  |
| 412     | SEEG        | bilateral  | clinical                  | 
| 420     | SEEG        | bilateral  | research                  |
| 424     | SEEG        | bilateral  | clinical                  |
| 440     | SEEG        | bilateral  | research                  |
| 442     | SEEG        | bilateral  | clinical                  |
| 452     | SEEG        | bilateral  | clinical                  |
| 454     | SEEG        | bilateral  | research                  |
| 459     | SEEG        | left       | research                  |
| 472     | SEEG        | bilateral  | clinical                  |
| 475     | SEEG        | bilateral  | clinical                  |
| 476     | SEEG        | bilateral  | research                  |
| 490     | SEEG        | bilateral  | research                  |
| 502     | SEEG        | bilateral  | research                  |
| 508     | SEEG        | left       | research                  |
| 517     | SEEG        | bilateral  | clinical                  |
| 520     | ECoG        | left       | research                  | 
| 522     | SEEG        | right      | research                  |
| 529     | SEEG        | right      | research                  |   
| 530     | SEEG        | bilateral  | clinical                  |   
| 536     | SEEG        | bilateral  | research                  |
| 560     | SEEG        | bilateral  | clinical                  |   
| 562     | SEEG        | right      | clinical                  |   
| 566     | SEEG        | left       | research                  |
| 572     | SEEG        | right      | research                  |
| 582     | SEEG        | bilateral  | clinical                  | 
| 583     | SEEG        | left       | research                  | 
| 588     | SEEG        | bilateral  | clinical                  | 
| 589     | SEEG        | left       | research                  | 
| 595     | SEEG        | left       | research                  |
| 596     | SEEG        | left       | research                  |
| 646     | SEEG        | bilateral  | research                  |
| 647     | SEEG        | left       | clinical                  |
| 648     | SEEG        | left       | research                  |
| 649     | SEEG        | left       | clinical                  |
| 650     | SEEG        | bilateral  | research                  |
| 651     | SEEG        | left       | clinical                  |
| 652     | SEEG        | bilateral  | research                  |



SEEG: Stereoelectroencephalography ("toothpicks")

ECoG: Electrocorticography ("grids and strips")







# Methods






### Visual

![visualMethodsImage](./pics/visualMethods.png)






### Bullet Point Methods

See [revellLab GitHub repository electrodeLocalization.py](https://github.com/andyrevell/revellLab/blob/main/packages/imaging/electrodeLocalization/electrodeLocalization.py) for example pipeline

1. **Step 1: Creation of brain 3D model**
	- Data needed:
		- Pre-implant T1 image. 
		- Preferably at 3T
		- Preferably using our high resolution 3T research protocol (not all patients acquire this image)
	- Software needed:
		- Freesurfer
		- Blender 3.9
		- Python 3.7+
		- Script blender_compress_mesh.py from [revellLab GitHub repository](https://github.com/andyrevell/revellLab)
	- Step 1.1: Cortical surface reconstruction of brain 
		- Software: Freesurfer
		- Command: recon-all -subjid ### -all -time -log logfile -nuintensitycor-3T -sd ### -parallel -threads 12
		- Takes about 1.5-2hrs for Andy's computer (AMD Ryzen 9 3900X 12-Core Processor, 64 GB RAM, Titan RTX GPU)
	- Step 1.2: Make 3D model
		- Convert lh.pial and rh.pial to scanner T1 space
			- Freesurfer command: mris_convert --to-scanner lh.pial lh.pial
		- Combine lh.pial and rh.pial AND convert to .stl 3D model file
			- reesurfer command: mris_convert --combinesurfs rh.pial lh.pial combined.stl
		- Convert to .stl to .glb file (To render on webpage using three.js)
			- Software: Blender 3.9
			- Use python script blender_compress_mesh.py from [revellLab GitHub repository](https://github.com/andyrevell/revellLab/blob/main/packages/imaging/electrodeLocalization/blender_compress_mesh.py)
			- Command: blender --background --factory-startup --addons io_scene_gltf2 --python blender_compress_mesh.py -- -i combined.stl -o brain.glb
			
2. **Step 2: Get implantation coordinates**
	- Data needed:
		- Pre-implant T1 image (from above)
		- Coordinates in the pre-implant T1 space above
			- If coordinates in a different space, need the corresponding T1 image and register the pre-implant T1 image above
		- Optional: output of [atlas localization pipeline](https://github.com/andyrevell/revellLab/blob/main/packages/atlasLocalization/atlasLocalization.py) to get tissue localization information of implant channels
	- Software needed:
		- FSL
		- Python 3.7+
	- Step 2.1: Register the pre-implant T1 image to the T1 image the coordinate file is in - skip if they are the same
		- Brain extract the images using FSL bet
		- Linear registration of the two images using FSL flirt
		- Apply the returned tranformation matrix from flirt to the coordinate file
			- FSL command: img2imgcoord -src ### -dest ### -xfm ### -mm ### > ###
			- See FSL's documentation of img2imgcoord for specific data sctructures files must be in
	- Step 2.2: Save coordinates in same location as the brain.glb file, name it electrodes.txt
		- electrodes.txt format
			- each row contains channel information. Column 1: Channel name; Column 2: x coordinate; Column 3: y coordinate; Column 4: z coordinate
			- Separation is a single space between columns (not comma or tab separated)
3. **Step 3: Get necessary files in single directory:**
	- See [example](https://github.com/andyrevell/implantRenders/tree/main/renders/sub-RID0278) 
	- File names:
		- brain.glb
		- electrodes.txt
		- index.html [Get here]( https://github.com/andyrevell/revellLab/blob/main/tools/threejs/index.html)  
	- These three files are all you need, and the html file should work provided you name the .glb and .txt files accordingly
	- To run on local computer, follow [these directions](https://threejs.org/docs/#manual/en/introduction/How-to-run-things-locally) 
		- I installed npm: npm install http-server -g (I forget if you need this to run the python -m http.server below)
		- python -m http.server
		- Type this into browser (I used Chrome, Firefox, and Microsoft Edge): http://localhost:8000/
		- The reason why you need the above is because web browser restrict loading of the 3D .glb files locally for security reasons.
				
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
